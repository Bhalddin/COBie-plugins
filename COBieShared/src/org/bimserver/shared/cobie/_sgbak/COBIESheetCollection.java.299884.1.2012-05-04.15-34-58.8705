package org.bimserver.shared.cobie;

import java.util.ArrayList;
import java.util.Arrays;
import java.util.HashMap;

public class COBIESheetCollection extends ArrayList<COBIERowDictionary>
{
	private String sheetName;
	private HashMap<String,COBIERowDictionary> guidIndex;
	private ArrayList<String> uniqueIdColumnNames;
	private HashMap<String,COBIERowDictionary> cobieRowIdStringIndex;
	private HashMap<String,COBIERowDictionary> cobieRowHashIndex;
	private static final ArrayList<String> contactKeys = new ArrayList<String>(Arrays.asList("Email"));
	private static final ArrayList<String> facilityKeys = new ArrayList<String>(Arrays.asList("Name"));
	private static final ArrayList<String> floorKeys = new ArrayList<String>(Arrays.asList("Name"));
	private static final ArrayList<String> spaceKeys = new ArrayList<String>(Arrays.asList("Name"));
	private static final ArrayList<String> zoneKeys = new ArrayList<String>(Arrays.asList("Name","Category","SpaceNames"));
	private static final ArrayList<String> typeKeys = new ArrayList<String>(Arrays.asList("Name"));
	private static final ArrayList<String> componentKeys = new ArrayList<String>(Arrays.asList("Name"));
	private static final ArrayList<String> systemKeys = new ArrayList<String>(Arrays.asList("Name","Category","ComponentNames"));
	private static final ArrayList<String> assemblyKeys = new ArrayList<String>(Arrays.asList("Name","SheetName","ParentName","ChildNames"));
	private static final ArrayList<String> connectionKeys = new ArrayList<String>(Arrays.asList("Name","ConnectionType","SheetName","RowName1","RowName2"));
	private static final ArrayList<String> spareKeys = new ArrayList<String>(Arrays.asList("Name"));
	private static final ArrayList<String> resourceKeys = new ArrayList<String>(Arrays.asList("Name"));
	private static final ArrayList<String> jobKeys = new ArrayList<String>(Arrays.asList("Name","TypeName","TaskNumber"));
	private static final ArrayList<String> impactKeys = new ArrayList<String>(Arrays.asList("Name","ImpactType","ImpactStage","SheetName","RowName"));
	private static final ArrayList<String> documentKeys = new ArrayList<String>(Arrays.asList("Name","Stage","SheetName","RowName"));
	private static final ArrayList<String> attributeKeys = new ArrayList<String>(Arrays.asList("Name","SheetName","RowName"));
	private static final ArrayList<String> coordinateKeys = new ArrayList<String>(Arrays.asList("Name","Category","SheetName","RowName"));
	private static final ArrayList<String> issueKeys = new ArrayList<String>(Arrays.asList("Name","SheetName1","RowName1","SheetName2","RowName2"));

	
	
	public COBIERowDictionary getByGuid(String guid)
	{
		if (guidExists(guid))
			return guidIndex.get(guid);
		else
			return null;
	}

	
	public COBIERowDictionary getByCOBieRowIdString(String cobieKey)
	{
		if(containsCOBieRowIdString(cobieKey))
			return cobieRowIdStringIndex.get(cobieKey);
		else
			return null;
	}

	public COBIERowDictionary getByRowHash(String hashValue)
	{
		if(containsRowHash(hashValue))
			return cobieRowHashIndex.get(hashValue);
		else
			return null;
	}

	public boolean containsCOBieRowIdString(String cobieRowIdString)
	{
		return (cobieRowIdStringIndex!=null && cobieRowIdStringIndex.containsKey(cobieRowIdString));
	}
	
	public boolean containsRowHash(String rowHash)
	{
		return (this.cobieRowHashIndex!=null && cobieRowHashIndex.containsKey(rowHash));
	}

	public boolean guidExists(String guid)
	{
		return guidIndex.containsKey(guid);
	}
	
	public static ArrayList<String> getKeyColumnNamesFromSheetName(String sheetName)
	{
		HashMap<String,ArrayList<String>> sheetNameKeyColumnNames = sheetNameToKeyColumnNames();
		if(sheetNameKeyColumnNames.containsKey(sheetName))
			return sheetNameKeyColumnNames.get(sheetName);
		else
			return null;
	}
	
	private static HashMap<String,ArrayList<String>> sheetNameToKeyColumnNames()
	{
		HashMap<String,ArrayList<String>> tmpSheetMap =
				new HashMap<String,ArrayList<String>>();
		tmpSheetMap.put("Contact",contactKeys);
		tmpSheetMap.put("Facility",facilityKeys);
		tmpSheetMap.put("Floor",floorKeys);
		tmpSheetMap.put("Space",spaceKeys);
		tmpSheetMap.put("Zone",zoneKeys);
		tmpSheetMap.put("Type",typeKeys);
		tmpSheetMap.put("Component",componentKeys);
		tmpSheetMap.put("System",systemKeys);
		tmpSheetMap.put("Assembly",assemblyKeys);
		tmpSheetMap.put("Connection",connectionKeys);
		tmpSheetMap.put("Spare",spareKeys);
		tmpSheetMap.put("Resource",resourceKeys);
		tmpSheetMap.put("Job",jobKeys);
		tmpSheetMap.put("Impact",impactKeys);
		tmpSheetMap.put("Document",documentKeys);
		tmpSheetMap.put("Attribute",attributeKeys);
		tmpSheetMap.put("Coordinate",coordinateKeys);
		tmpSheetMap.put("Issue",issueKeys);

		return tmpSheetMap;
	}
	
 	public COBIESheetCollection()
	{
		super();
		guidIndex = new HashMap<String,COBIERowDictionary>();
		cobieRowIdStringIndex = new HashMap<String,COBIERowDictionary>();
		cobieRowHashIndex = new HashMap<String,COBIERowDictionary>();
	}
 	
 	
	
	public COBIESheetCollection(String ownerSheetName)
	{
		super();
		this.sheetName = ownerSheetName;
		HashMap<String,ArrayList<String>> sheetNameUniqueIdColumnNames = 
				sheetNameToKeyColumnNames();
		cobieRowIdStringIndex = new HashMap<String,COBIERowDictionary>();
		cobieRowHashIndex = new HashMap<String,COBIERowDictionary>();
		if (sheetNameUniqueIdColumnNames.keySet().contains(ownerSheetName))
		{
			this.uniqueIdColumnNames =
					sheetNameUniqueIdColumnNames.get(ownerSheetName);
		}
		
	}
	
	@Override
	public boolean add(COBIERowDictionary cobieRowData)
	{
		boolean returnVal = super.add(cobieRowData);
		if(!cobieRowData.isGuidEmpty())
		{
			String guid = cobieRowData.getGuid();
			guidIndex.put(guid, cobieRowData);

		}
		if(cobieRowData.getCOBieRowIdString()!=null && cobieRowData.getCOBieRowIdString().length()>0)
			cobieRowIdStringIndex.put(cobieRowData.getCOBieRowIdString(),cobieRowData);
		if(cobieRowData.getCOBieRowIdHash()!=null && cobieRowData.getCOBieRowIdHash().length()>0)
			this.cobieRowHashIndex.put(cobieRowData.getCOBieRowIdHash(),cobieRowData);
		return returnVal;
	}
	
	public ArrayList<String> getUniqueIdColumnNames()
	{
		return uniqueIdColumnNames;
	}


	public HashMap<String,COBIERowDictionary> getCobieRowHashIndex()
	{
		return cobieRowHashIndex;
	}


	public void setCobieRowHashIndex(HashMap<String,COBIERowDictionary> cobieRowHashIndex)
	{
		this.cobieRowHashIndex = cobieRowHashIndex;
	}
}
